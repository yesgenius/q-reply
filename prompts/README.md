# Модуль prompts

## Описание
Модуль для управления промптами (инструкциями) при взаимодействии с языковыми моделями GigaChat. Обеспечивает структурированную генерацию ответов на вопросы конференций с использованием контекста из предыдущих вопросов и ответов.

## Основные возможности
- Категоризация вопросов по заданным категориям
- Генерация ответов на основе контекста из предыдущих Q&A пар
- Кэширование системных промптов для оптимизации производительности
- Структурированный вывод в формате JSON
- Поддержка дополнительного контекста (ответы, тема конференции)

## Требования
- Python 3.8+
- Модуль `gigachat` (клиент для работы с GigaChat API)
- Настроенные учетные данные для доступа к GigaChat

## Структура модуля
```
prompts/
├── __init__.py                    # Инициализация пакета
├── base_prompt.py                 # Базовый шаблон для создания промптов
├── define_category_prompt.py      # Категоризация вопросов
├── get_answer_prompt.py           # Генерация ответов на вопросы
└── README.md                      # Документация
```

## API Reference

### Публичные переменные

#### base_prompt.py
- `messages: str` - JSON-строка с последними отправленными сообщениями

### Публичные функции

#### define_category_prompt.py

**`update_system_prompt(categories: Dict[str, str]) -> str`**
- Инициализирует систему категоризации
- `categories` - словарь категорий (название: описание)
- Возвращает текст системного промпта

**`run(user_question: str, answer: Optional[str] = None) -> Tuple[str, List[Dict]]`**
- Категоризирует вопрос
- `user_question` - вопрос для категоризации
- `answer` - опциональный ответ для улучшения контекста
- Возвращает кортеж: (JSON с результатом, список сообщений)

Формат результата:
```json
{
  "category": "Название категории",
  "confidence": 0.95,
  "reasoning": "Краткое объяснение выбора"
}
```

#### get_answer_prompt.py

**`update_system_prompt(topic: Optional[str] = None) -> str`**
- Инициализирует систему генерации ответов
- `topic` - опциональная тема конференции
- Возвращает текст системного промпта

**`run(user_question: str, qa_pairs: List[Dict[str, str]]) -> Tuple[str, List[Dict]]`**
- Генерирует ответ на вопрос
- `user_question` - вопрос для ответа
- `qa_pairs` - список словарей с ключами "question" и "answer"
- Возвращает кортеж: (JSON с результатом, список сообщений)

Формат результата:
```json
{
  "answer": "Сгенерированный ответ",
  "confidence": 0.9,
  "sources_used": ["context", "domain_knowledge"]
}
```

## Интеграция с другими компонентами

Модуль `prompts` используется в основных скриптах системы:

1. **category_filler.py** - использует `define_category_prompt` для определения категорий исторических вопросов
2. **answer_generator.py** - использует оба модуля:
   - `define_category_prompt` для фильтрации по категориям
   - `get_answer_prompt` для генерации ответов на основе контекста

## Тестовый запуск

Каждый модуль можно протестировать отдельно:

### Тест категоризации:
```bash
python -m prompts.define_category_prompt
```

### Тест генерации ответов:
```bash
python -m prompts.get_answer_prompt
```

### Тест базового модуля:
```bash
python -m prompts.base_prompt
```

Тесты демонстрируют:
- Инициализацию системы
- Обработку вопросов с контекстом и без
- Валидацию результатов
- Обработку ошибок
- Структуру входных и выходных данных