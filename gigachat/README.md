# GigaChat API Client

## Описание
Компонент для взаимодействия с API GigaChat - российской языковой модели от Сбера. Предоставляет удобный интерфейс для отправки сообщений в чат, получения ответов и создания векторных представлений текста (эмбеддингов).

## Основные возможности
- Отправка сообщений и получение ответов от GigaChat
- Создание векторных представлений текста для семантического поиска
- Поддержка потоковой передачи ответов (streaming)
- Автоматическое управление токенами доступа
- Два режима аутентификации: Basic и mTLS (сертификаты)
- Встроенная логика повторных попыток при сбоях
- Получение списка доступных моделей

## Требования
- Python 3.7+
- Зависимости из `requirements.txt`:
  - requests
  - python-dotenv
  - urllib3
  - и другие служебные библиотеки

## Структура модуля
```
gigachat/
├── __init__.py       # Инициализация пакета
├── config.py         # Загрузка конфигурации из переменных окружения
├── client.py         # Основной клиент для работы с API
└── README.md         # Эта документация
```

## API Reference

### Публичные классы

#### GigaChatConfig
Класс для загрузки и хранения конфигурации из переменных окружения.

**Основные атрибуты:**
- `auth_basic` - строка для базовой аутентификации
- `scope` - область доступа API (GIGACHAT_API_PERS по умолчанию)
- `tls_cert`, `tls_key` - пути к сертификатам для mTLS
- `request_timeout` - таймаут запросов (30 сек по умолчанию)
- `stream_timeout` - таймаут для потоковых ответов (300 сек по умолчанию)

#### GigaChatClient
Основной класс для работы с API GigaChat.

**Основные методы:**
- `chat_completion(messages, model="GigaChat", ...)` - отправка сообщений и получение ответа
- `create_embeddings(input_texts, model="Embeddings")` - создание векторных представлений текста
- `get_models()` - получение списка доступных моделей
- `get_access_token()` - получение токена доступа (для Basic аутентификации)

### Публичные функции

#### load_config(env_file=".env")
Загружает конфигурацию из файла переменных окружения.

## Интеграция с другими компонентами

Компонент используется в системе Q-REPLY для:
- Определения категорий вопросов через промпты
- Создания эмбеддингов для семантического поиска
- Генерации ответов на основе контекста

Взаимодействует с:
- `prompts/` - модули промптов используют клиент для получения ответов
- `embeddings/` - модули эмбеддингов используют клиент для векторизации
- Основные скрипты системы (`category_filler.py`, `answer_generator.py`)

## Тестовый запуск

Для проверки работоспособности компонента:

1. Создайте файл `.env` с настройками:
```
GIGACHAT_AUTH_BASIC=ваш_токен_base64
GIGACHAT_SCOPE=GIGACHAT_API_PERS
```

Или для сертификатной аутентификации:
```
GIGACHAT_TLS_CERT=путь/к/сертификату.crt
GIGACHAT_TLS_KEY=путь/к/ключу.key
```

2. Запустите тестовый модуль:
```bash
python -m gigachat.client
```

Тест выполнит:
- Получение токена доступа (для Basic режима)
- Получение списка моделей
- Отправку тестового сообщения
- Создание эмбеддингов для тестовых текстов
- Проверку потоковой передачи ответов

Результаты тестирования будут выведены в консоль с подробным логированием каждого этапа.